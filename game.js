"use strict";const TOK_VAR_EXP=1,TOK_DECIMAL=2,TOK_INTEGER=3,TOK_FRACTION=4,TOK_ADD=5,TOK_SUB=6,TOK_EQ=7,TOK_NE=8,TOK_LT=9,TOK_GT=10,TOK_LE=11,TOK_GE=12,TOK_SLASH=13,tok_text=[,,,,,"+","-","=","≠","<",">","≤","≥","/"],tok_latex=[,,,,,"+","-","="," \\ne ","<",">"," \\le "," \\ge ","/"];function poly_parse(e,t=!0){const A={"⁰":0,"¹":1,"²":2,"³":3,"⁴":4,"⁵":5,"⁶":6,"⁷":7,"⁸":8,"⁹":9,"=":0,"==":0,"≠":1,"!=":1,"/=":1,"<>":1,"><":1,"<":2,">":3,"≤":4,"<=":4,"=<":4,"<<":4,"⇒":5,">=":5,"=>":5,">>":5,"+":6,"-":7,"+-":7,":":8,"/":8,_:[TOK_EQ,TOK_NE,TOK_LT,TOK_GT,TOK_LE,TOK_GE,TOK_ADD,TOK_SUB,TOK_SLASH]},r=e=>e.toString().slice(1,-1),n="("+r(/[a-z](?:[⁰¹²³⁴⁵⁶⁷⁸⁹]|\^ *[0-9]+|[1-9])?/)+")|("+r(/[-]?[.,][0-9]+|[-]?[0-9]+[.,][0-9]*/)+")|("+r(/[0-9]+/)+")|("+r(/[:/][0-9]+/)+")|("+r(/[<>=]{1,2}|[!/]=|[≤≥≠]/)+")|("+r(/[*·'×/:]/)+")|("+r(/\+-|[-+]/)+")|.",l=new RegExp(n,"g"),o=[...e.matchAll(l)];let a=[];for(let w in o){w=o[w];for(let e=1;e<=8;++e)if(null!=w[e]){let t=w[e];switch(e){case 1:{let e=t[0],r=t.length;r>1&&(r=t[1]in A?A[t[1]]:parseInt(t.slice("^"==t[1]?2:1))),a.push([TOK_VAR_EXP,e,r]);break}case 2:a.push([TOK_DECIMAL,parseFloat(t.replaceAll(",","."))]);break;case 3:a.push([TOK_INTEGER,parseInt(t)]);break;case 4:a.push([TOK_FRACTION,parseInt(t.slice(1))]);break;case 5:case 6:case 7:t in A&&a.push(A._[A[t]])}break}}let s={fac:1,vars:[]},i=!1,f=!1,c=!1,g=[],_=[],d=null,u=!1,p=function(){t&&s.vars.sort(),_.push(s),i=!1,f=!1,c=!1,s={fac:1,vars:[]}};var m=[];for(let w=0;w<a.length;++w)if("object"!=typeof a[w])switch(a[w]){case TOK_ADD:if(m.push(a[w]),!i)break;p();break;case TOK_SUB:if(m.push(a[w]),!i){s.fac=-s.fac;break}p(),s.fac=-s.fac;break;case TOK_SLASH:m.push(a[w]),u=!0;break;case TOK_EQ:case TOK_NE:case TOK_LT:case TOK_GT:case TOK_LE:case TOK_GE:if(!i){u=!0;break}if(d){u=!0,m.push(a[w]);break}p(),g=_,_=[],d=a[w]}else switch(m=[],a[w][0]){case TOK_VAR_EXP:for(let e=0;e<a[w][2];++e)s.vars.push(a[w][1]);i=!0;break;case TOK_DECIMAL:case TOK_INTEGER:if(f){u=!0;break}s.fac*=a[w][1],i=f=!0;break;case TOK_FRACTION:if(c){u=!0;break}if(0==a[w][1]){u=!0;break}s.fac/=a[w][1],i=f=c=!0}i?p():1!=s.fac&&(u=!0);let h=function(e,t){let A=e=>{let t={},A=0,r=1,n=e.vars;for(let l=0;l<n.length;++l){let e=n[l];t[e]?t[e]+=1:t[e]=1}for(let l in t)t[l]>A&&(A=t[l]),r*=t[l];return[e.fac,n,A,r]};return e=A(e),t=A(t),e[2]!=t[2]?t[2]-e[2]:t[3]!=e[3]?t[3]-e[3]:e[1]!=t[1]?e[1]<t[1]?-1:1:t[0]-e[0]};if(t&&(_.sort(h),g.sort(h)),d&&_.length){let e=e=>"x"==e,t=e=>e.reduce(((e,t)=>e+t)),A=t=>t.vars.filter(e).length,r=e=>e.vars.length,n=t(g.map(r)),l=t(_.map(r)),o=t(g.map(A)),a=t(_.map(A));if(a>o||a==o&&l>n){switch(d){case TOK_LT:d=TOK_GT;break;case TOK_GT:d=TOK_LT;break;case TOK_LE:d=TOK_GE;break;case TOK_GE:d=TOK_LE}let e=g;g=_,_=e}}return[g,d,_,u,m]}function random2(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1)+e)}function make_fraction(e,t=!0){let A=1;e<0&&(A=-A,e=-e);let r=[A*Math.round(e),1];for(let n=1;n<=30;++n){let l=[],o=e;for(let e=0;e<n;++e)l.push(Math.trunc(o)),o=1/(o-l[e]);let a=l[n-1],s=1;for(let e=n-2;e>=0;--e){let t=l[e]*a+s;s=a,a=t}if(n>1&&t&&1!=r[1]&&a>300&&s>300)break;if(r=[A*a,s],Math.abs(e-a/s)<=1e-6)break}return r}Object.defineProperty(Array.prototype,"shuffle",{value:function(){for(let e=this.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[this[e],this[t]]=[this[t],this[e]]}return this}});const RANK_NEGATION=4,RANK_FAC_NEG=8,RANK_FAC_FRAC=7,RANK_FAC_FRAC_WHOLE=50,RANK_FAC_SIMPLE=1,RANK_FAC_OTHER=3,RANK_VAR_COUNT=1,RANK_VAR_HIGHER=1,RANK_VAR_EXP=2,RANK_ADD=3;function poly_rank(e){return Math.round(Math.max(poly_rank_do(e),poly_rank_do(poly_simplify(e))))}function poly_rank_do(e){let t=0;for(let A=0;A<e.length;++A)t+=RANK_ADD+poly_rank_do_term(e[A]);return t}function poly_rank_do_term(e){if(e.hasOwnProperty("mul"))return e.mul.map((e=>poly_rank_do(e))).reduce(((e,t)=>e*t));if(e.hasOwnProperty("neg"))return RANK_NEGATION*poly_rank_do_term(e.neg);return poly_rank_do_factor(e.fac)+poly_rank_do_vars(e.vars)}function poly_rank_do_factor(e){let t=make_fraction(e),A=0,r=Math.abs(t[0]);return A=r<=5||10==r||20==r?RANK_FAC_SIMPLE:RANK_FAC_OTHER*Math.max(1,Math.log10(r)),e<0&&(A+=RANK_FAC_NEG),1!=t[1]&&(A*=RANK_FAC_FRAC,t[1]<r&&(A*=RANK_FAC_FRAC_WHOLE)),A}function poly_rank_do_vars(e){let t={},A=0;for(let l=0;l<e.length;++l){let r=e[l];t[r]?t[r]+=1:t[r]=1,A=Math.max(A,t[r])}let r=0,n=0;for(let l in t)t[l]>1&&++n,++r;return RANK_VAR_EXP**A*(RANK_VAR_COUNT*(1+r))*(RANK_VAR_HIGHER*(1+n))}const latex_sign=e=>tok_latex[e];function latex_render(e,t){let A=MathJax.getMetricsFor(gel("gamewin"));return MathJax.tex2svgPromise(e,A).then(t)}function poly_renderdom(e,t){return latex_render(poly_render_latex(e),t)}function poly_render_latex(e){let t="";for(let A=0;A<e.length;++A){let r=e[A];if(r.hasOwnProperty("neg")){r=r.neg,t+="-";let e=poly_renderterm_latex(r);e="\\left("+e+"\\right)",t+=e}else{if(A>0){if(r.hasOwnProperty("fac")&&r.fac<0){t+="-",t+=poly_renderterm_latex({fac:-r.fac,vars:r.vars});continue}t+="+"}t+=poly_renderterm_latex(r)}}return t}function poly_renderterm_latex(e){if(e.hasOwnProperty("neg"))return"-\\left("+poly_renderterm_latex(e.neg)+"\\right)";if(e.hasOwnProperty("mul")){let t=e.mul.map((e=>{let t=poly_render_latex(e);return t.match(/[-+()]/)?"\\left("+t+"\\right)":t}));for(let e=0;e+1<t.length;++e)"\\left("!=t[e].slice(0,6)&&"\\left("!=t[e+1].slice(0,6)&&(t[e]+=" \\cdot ");return t.join("")}let t=make_fraction(e.fac),A="";if(1==t[1]){A=t[0]+"";let e=A.match(/[e]\+/);e?A=A.replace(/[e]\+/,"\\cdot 10^{")+"}":(e=A.match(/[e]/))&&(A=A.replace(/[e]/,"\\cdot 10^{")+"}"),A=A.replace(/[.]/,"{,}")}else t[0]<0&&(A+="-",t[0]*=-1),A+="\\frac{"+t[0]+"}{"+t[1]+"}";let r={},n=e.vars;n.length&&("1"==A&&(A=""),"-1"==A&&(A="-"));for(let l=0;l<n.length;++l){let e=n[l];r[e]?r[e]+=1:r[e]=1}for(let l in r)1==r[l]?A+=l:r[l]>=10||r[l]<0?A+=l+"^{"+r[l]+"}":A+=l+"^"+r[l];return A}const text_sign=e=>tok_text[e];function poly_rendertext(e){let t="";for(let A=0;A<e.length;++A){let r=e[A];if(r.hasOwnProperty("neg")){r=r.neg,t+=0==A?"-":" - ";let e=poly_renderterm(r);e.match(/[-+()]/)&&(e="("+e+")"),t+=e}else{if(A>0){if(r.hasOwnProperty("fac")&&r.fac<0){t+=" - ",t+=poly_renderterm({fac:-r.fac,vars:r.vars});continue}t+=" + "}t+=poly_renderterm(r)}}return t}function poly_renderterm(e){if(e.hasOwnProperty("neg"))return"-("+poly_renderterm(e.neg)+")";if(e.hasOwnProperty("mul")){let t=e.mul.map((e=>{let t=poly_rendertext(e);return t.match(/[-+()]/)?"("+t+")":t}));for(let e=0;e+1<t.length;++e)"("!=t[e][0]&&"("!=t[e+1][0]&&(t[e]+="·");return t.join("")}let t=make_fraction(e.fac),A=t[0]+"",r={},n=e.vars;n.length&&("1"==A&&(A=""),"-1"==A&&(A="-"));for(let l=0;l<n.length;++l){let e=n[l];r[e]?r[e]+=1:r[e]=1}for(let l in r)1==r[l]?A+=l:A+=l+"^"+r[l];return 1!=t[1]&&(A+="/"+t[1]),A}function poly_simplify(e,t=null){let A=[];for(let r=0;r<e.length;++r){A=poly_add(A,poly_simplify_term_to_poly(e[r],t))}return poly_sort(A)}function poly_add(e,t){let A={};for(let n=0;n<e.length;++n){let t=e[n].vars.join("");A[t]?A[t]+=e[n].fac:A[t]=e[n].fac}for(let n=0;n<t.length;++n){let e=t[n].vars.join("");A[e]?A[e]+=t[n].fac:A[e]=t[n].fac}let r=[];for(let n in A)if(0!=A[n]){let e={},t=0,l=1;for(let A=0;A<n.length;++A){let t=n[A];e[t]?e[t]+=1:e[t]=1}for(let A in e)e[A]>t&&(t=e[A]),l*=e[A];r.push([A[n],n.split(""),t,l])}return r.sort(((e,t)=>e[2]!=t[2]?t[2]-e[2]:t[3]!=e[3]?t[3]-e[3]:e[1]!=t[1]?e[1]<t[1]?-1:1:t[0]-e[0])),r=r.map((e=>({fac:e[0],vars:e[1]}))),0==r.length&&r.push({fac:0,vars:[]}),r}function poly_multiply(e,t){let A=[];for(let r=0;r<e.length;++r){let n=e[r];for(let e=0;e<t.length;++e){let r=t[e],l={fac:n.fac*r.fac,vars:n.vars.concat(r.vars)};0==l.fac&&(l.vars=[]),l.vars.sort(),A=poly_add(A,[l])}}return A}function poly_simplify_term_to_poly(e,t=null){if(e.hasOwnProperty("neg")){let A=poly_simplify_term_to_poly(e.neg,t);for(let e=0;e<A.length;++e)A[e].fac*=-1;return A}if(e.hasOwnProperty("mul")){let A=e.mul;if(0==A.length)return[{fac:1,vars:[]}];let r=poly_simplify(A[0],t);for(let e=1;e<A.length;++e){r=poly_multiply(r,poly_simplify(A[e],t))}return r}let A=[],r=e.fac;if(t)for(let n=e.vars,l=0;l<n.length;++l)t[n[l]]?r*=t[n[l]]:A.push(n[l]);else A=e.vars.join("").split("");return 0==r&&(A=[]),A.sort(),[{fac:r,vars:A}]}function poly_sort(e){let t=function(e){if(is_array(e))for(let A=0;A<e.length;++A)t(e[A]);else e.hasOwnProperty("mul")?t(e.mul):e.hasOwnProperty("neg")?t(e.neg):e.vars.sort()},A=cloneArray(e);return t(A),A.sort((function(e,t){let A=e=>{if("neg"in e){let t=A(e.neg);return t[0]*=-1,t}if("mul"in e){return[0,0,0,0]}let t={},r=0,n=1,l=e.vars;for(let A=0;A<l.length;++A){let e=l[A];t[e]?t[e]+=1:t[e]=1}for(let A in t)t[A]>r&&(r=t[A]),n*=t[A];return[e.fac,l,r,n]};return e=A(e),t=A(t),e[2]!=t[2]?t[2]-e[2]:t[3]!=e[3]?t[3]-e[3]:e[1]!=t[1]?e[1]<t[1]?-1:1:t[0]-e[0]})),A}function cloneObject(e){let t={};for(let A in e)is_array(e[A])?t[A]=cloneArray(e[A]):"object"==typeof e[A]?t[A]=cloneObject(e[A]):t[A]=e[A];return t}function cloneArray(e){let t,A=e.slice(0),r=A.length;for(t=0;t<r;++t)is_array(A[t])||"object"!=typeof A[t]||(A[t]=cloneObject(A[t]));return A}Array.prototype.is_array=!0;const serialize=JSON.stringify,displayObject=serialize,displayArray=serialize,unserialize=JSON.parse,is_array=e=>e.is_array;function propObject(e){for(let t in e)this[t]=e[t];return this}function protoObj(e,t){return propObject.call(e.prototype,t),e}function declObj(params,constructorcode,elements,memberfunctions){let f;return eval("f=function("+params+") { propObject.call(this, elements); "+constructorcode+"; }"),protoObj(f,memberfunctions)}const rgel=(e,t)=>e.getElementById(t),gel=e=>rgel(document,e),id=e=>gel(e).selectedIndex,ids=(e,t)=>gel(e).selectedIndex=t,ch=e=>gel(e).checked?1:0,chs=(e,t)=>gel(e).checked=t>0,tx=e=>gel(e).value,txs=(e,t)=>gel(e).value=t;function dom_wipe(e){let t,A=e.childNodes;for(t=A.length;t-- >0;)e.removeChild(A[t]);return e}const clearBlock=dom_wipe,dom_is_event_activator_name={onkeydown:1,onmouseover:1,onclick:1,onblur:1,onfocus:1,onmouseout:1,ondblclick:1,onmouseup:1,onmousedown:1,onkeypress:1,onkeyup:1,onchange:1,onload:1,onmousemove:1,onselect:1,onsubmit:1,onunload:1,onerror:1,className:1};function dom_tag_finish_with(e,t){for(let A in t)dom_is_event_activator_name[A]?e[A]=t[A]:e.setAttribute(A,t[A]);return e}const dom_add_children=(e,t)=>(t.map((t=>dom_append(e,t))),e),dom_tag=e=>document.createElement(e),dom_text=e=>document.createTextNode(e),dom_tag_with=(e,t)=>dom_tag_finish_with(dom_tag(e),t),dom_tag_class=(e,t)=>dom_tag_with(e,{className:t}),dom_tag_class_with=(e,t,A)=>dom_tag_finish_with(dom_tag_class(e,t),A),dom_tag_with_children=(e,t)=>dom_add_children(dom_tag(e),t),dom_tag_attr_with_children=(e,t,A)=>dom_add_children(dom_tag_with(e,t),A),dom_tag_class_with_children=(e,t,A)=>dom_add_children(dom_tag_class(e,t),A),dom_tag_text=(e,t)=>dom_tag_with_children(e,[dom_text(t)]),dom_tag_attr_text=(e,t,A)=>dom_tag_finish_with(dom_tag_text(e,A),t),dom_append=(e,t)=>e.appendChild(t),dom_rtags=(e,t)=>e.getElementsByTagName(t);function dom_rtext(e){let t=e.childNodes;if(!t)throw"dom_rtext";return t.map((e=>e.nodeValue)).join("")}function dom_ftag(e,t){let A=dom_rtags(e,t);if(0==A.length)throw"tag "+t+" missing";if(A.length>1)throw"tag "+t+" is ambiguous";return A[0]}var magnification=1,magnif_offsx=0,magnif_offsy=0,imageCache={};function cacheImage(e){if(imageCache[e])return imageCache[e];let t=dom_tag("img");return t.src=e,imageCache[e]=t,t}function addImage(e,t,A,r){if(r=r*magnification-magnif_offsy,(A=A*magnification-magnif_offsx)<0||r<0)return 0;if(A>=e.offsetWidth||r>=e.offsetHeight)return 0;let n=cacheImage(t).cloneNode(0);return n.style.left=Math.floor(A+e.offsetLeft)+"px",n.style.top=Math.floor(r+e.offsetTop)+"px",1!=magnification&&(n.height=Math.floor(32*magnification),n.width=Math.floor(32*magnification)),dom_append(e,n),n}function moveImage(e,t,A,r){if(!t)return;let n=A*magnification-magnif_offsx,l=r*magnification-magnif_offsy;t.style.left=Math.floor(n+e.offsetLeft)+"px",t.style.top=Math.floor(l+e.offsetTop)+"px"}function removeImage(e,t){t&&e.removeChild(t)}function changeImage(e,t){e&&(e.src=t)}function imageSetZ(e,t){e&&(e.style.zIndex=t)}const game_speed_multiplier=1;var render_fps=20,game_enabled=!0,oldwidth=null,cursorcount=0,curinput="",focused=!0,score=0;function render_tick(){render_schedule_next();var e=gel("statswin").offsetWidth;if(e!==oldwidth&&(resize(),oldwidth=e),game_enabled){game_tick(),decorations_tick();let e=render_fps/8;if(++cursorcount>=e){cursorcount-=e;var t=gel("cursor");t.style.marginLeft="-1ex",t.textContent="_"==t.textContent?" ":"_"}stars_update()}}function render_schedule_next(){setTimeout(render_tick,1e3*game_speed_multiplier/render_fps)}function render_score(){const e=(e,t)=>{let A=gel(e);A&&(A.innerText=t)};e("score",Math.round(score,1)),e("score1",Math.round(score,1)),e("skill",Math.round(cur_challenge_total,1)+"/"+Math.round(target_challenge,1)),e("time",Math.round(game_timer,1)),e("time1",Math.round(game_timer,1)),e("miss",Math.round(misses,1))}function render_input(){let e=poly_parse(curinput),t=(e[2],poly_render_latex(e[2]));if(e[1]){let A=latex_sign(e[1]);t=poly_render_latex(e[0])+A+t}for(let A=0;A<e[4].length;++A)t+=latex_sign(e[4][A]);latex_render(t,(e=>{let t=gel("input"),A=e;t.replaceChild(A,t.childNodes[2]),A.id="inputt"}))}function resize(){let e=gel("gamewin"),t=gel("statswin");t.style.height=gel("statstab").offsetHeight+2*gel("score").offsetHeight*1.1+"px",e.style.width=window.innerWidth+"px",e.style.height=window.innerHeight+"px",t.style.top=e.offsetHeight-t.offsetHeight+"px",e.style.height=t.offsetTop+"px";for(let A=0;A<6;++A){let t=gel("stars"+A);t&&(t.style.width=e.style.width,t.style.height=e.style.height)}return!1}function main_load(){resize(),dom_wipe(gel("gamewin")),document.addEventListener("keydown",keydown,!1),document.addEventListener("keyup",keyup,!1),window.addEventListener("resize",resize,!1),window.addEventListener("focus",(e=>setfocus(!0)),!1),window.addEventListener("blur",(e=>setfocus(!1)),!1),render_schedule_next()}let alt=!1,meta=!1,ctrl=!1,shift=!1;function keydown(e){if(e.MetaKey);else if(8==e.keyCode)curinput.length>0&&(curinput=curinput.slice(0,-1),render_input());else if(13==e.keyCode)game_submit(poly_parse(curinput)),curinput="",render_input();else if(1==e.key.length){if(alt&&"l"==e.key)return setlanguage("en"==curlang?"fi":"en"),!1;if(alt&&"v"==e.key)return game_over(),!1;curinput+=e.key,render_input()}else"Pause"==e.key||("Shift"==e.key?shift=!0:"Alt"==e.key||"AltGraph"==e.key?alt=!0:"Control"==e.key?ctrl=!0:"Meta"!=e.key&&"Compose"!=e.key||(meta=!0));return!1}function keyup(e){return"Shift"==e.key?shift=!1:"Alt"==e.key||"AltGraph"==e.key?alt=!1:"Control"==e.key?ctrl=!1:"Meta"!=e.key&&"Compose"!=e.key||(meta=!1),!1}function setfocus(e){return focused=e,gel("statswin").style.backgroundColor=focused?"#00A":"#000",!1}function game_over(){game_enabled=!1,gel("gameover").style.display="block",render_score()}function game_reset(){dom_wipe(gel("gamewin")),gel("gameover").style.display="none",curinput="",score=misses=game_timer=completed=last_scorelog=input_idle=cur_challenge_total=0,cur_challenges={},game_enabled=!0,skill_multiplier=1,target_challenge=10,gamespeed=4,input_idle_timeout=5,scorelog=[],render_score(),render_input()}const star_images=["","","","iVBORw0KGgo!ANSUhEUgAADw!AhwAQM!CqcFkx!ABlBMVEU!BYWFjQGshd!AAXRSTlMAQObYZgAABv5JREFUeNrt3YGGFHEAx/Hf7DibUhsikAIkFJCQ2kfoAXqIwwFO5lH2SbKPcIAQFhDgACtJQBKorrvb+d3n8wAL4+v3H3ZmAg%&&&&&!ABApfuh2qtclUW4Bie5KkfhGnzPVVlN4eqd5qo8CtUb/HYKzafoh6HavSk&!!!!AAh2sKzY7WodlyG5ot16HZaheaHW1Ds3EKAMBM3Z5Cs2WYL18o5vE2/HcKxgajY&&!!FhsQrOjbWg27kKz5To0u7MLzYZ1!!AA+CPjJjQb16HZaheaLbdhtvwBjSF0mwI&&!MG+LKTQ7CtVWU2i2XIdmq22YLR8mZpwC&AXLJxE5oN69BstQuz5Vlaxl1oNoRuUw&!AACAy/EsVHsfqr0J1U5CtY+h2oM!!!!AAMDvxik0W65Ds9UuNFtuw2y5wAyh25QE&AAIDbU2i2DNVWU2h2dxtmS8EchWqL&&&!AD1uhWrvQrV9qHYSqn0P1U5DtVcB&!C4GpvQbDgOzcZ9aDachblTsA3GKRo&&!!!B4EqqdhGrfQ7X3odqHMF82mKcB!AgL+wD9WOw3wpmE/h8igY&!B4E6q9DPOlYF6HP6Bg&&&!!!CehGrH4bp9ySXah2s2nF3uj3PNxn0uz2IfrtlwfP0/zmxnchOu27swO25VAQ&&&AYB2q7UOz4Tg0G/eh2XAWLsQGAw!!!AAPA0VHsfqn3NRW3CATvpfnaKb93PTnGaCxrOwwF7kgsaz0O1d6HaF&&!!!!AuBEWU2g2rEOz1S40W25Ds3EX5ssGMwU&!AB+tQjVHoRqj6fQ7HGo9nYKzR6GavcC&&AAwMWsptBsGeZLwdydwj9TM!!!!ADAYhOaDevQbNyFZsttUDA2mAM1BQ!!!AAIDDcjtUexiqvZ1Cs0dBwdRtME7R!AwGIXmg1nodl4HpoNx6HZ+CXcsNf4AXgRLF7lzJ1daLZch5mxwQ&&&!!AAsQrUhVFttQ7OjbWi22oVmy3VoNk4B&&!!AACAn26Fag9CtTeh2mlQMDaYA/U8&!AAwI20Cc2G49Bs3Idmw3n4vxSMglEwCsYFBg!!AACGUG01hWZH29BstQnNlutwDWww&AACw2odmwDs3GXWi23AYFY4M5UFMALs0iVHsQqj2eQrPHodrbKTR7GKrdCw&&&&&!!!!ABw40yh2bAOzcZdaLY8CxegYGwwTtE&!!AADAcB5mywVm3Idmw3FoNuxCtXU&!IAbahGqLUO11RSaPQrVXkyh2cNQ7XY&&!!!D+3D5U+xTmS8Ech8ulYOBJqPYu/B1T+jQcjs/5796H6oK/hurb2ZNwOL7kv/sWqp2Gq+LWGg&FiEakeh2moKze5uw2wpmGWodm8K&&!ACX7Wmo9j5U+xqqnYRq30K101DtSQ&&&&!!gIP0A1vFkXxne71B!AAElFTkSuQmCC","iVBORw0KGgo!ANSUhEUgAADw!AhwCAM!CnYDt!AAwFBMVEU!C%%%%%%%%%JtUYd!AP3RSTlMAHVZzyeaPOawOK57XYKK/upbj9vfx0oT+/fv0+WJX5IrQku76fPDzQ8btVc6jBtj4/LkRsK7Z6eh4S2FmUCKtkI/1!kiUlEQVR42uzdVZb0NhCA0bLUsmTZYWZmZs7sf1fp5Ew8eQ39UOfeXXyCqg@@@@@@@@@@@@@@@@@@@@@!!AgMyWUmtZAg!FIrl3Z1KQE!Dp+1cBAwAAkL9/sxcw!ALGs7rUs!BATn200+gB!A/yUBD!AAIY!A/AEG!AU6ABAADAHm!AAUsP4F!gv6XUWpY@@@@@&&AAD4v22z97kF!ApDbrPsZeZw!EBicz3a1bHO!AgNz9q4ABAABIbqtHu3XULQ!CCnubfTPgM!By6qOdRg8!C4VwQw!AeAIN!AhmABAACANUg!AoYP0LAABAfrPuY+x1Bg!KS2zd7nFg@@&!!!ADwIlt77Eg!JBbWccYawk!DIrFza7y4l!AIHf/Zi9g!AWC7tT5cl!AIKnS7pQ!CApGq7UwM!DuGQEM!AnkADAACAIVg!BgDRI!AKOH//AgAAQFnHGGsJ!AyG3pvS8B@@@@@&!AA8OLbZ+9wC!AUpt1H2OvMw!CCxuR7t6lhn!AQO7+TV7!AAsNWj3TrqFg!JDT3NtpnwE!A59dFOowc!DcKwIY!APIEG!AQ7!ADAGiQ!AUcP7+BQAAgFn3MfY6Aw!FLbZu9zCw@&&!AAIJVt9j63!AgNRm3cfY6ww!BIbK5HuzrWGQ!JC7f5MXM!AGz1aLeOugU!DkNPd22mc!BATn200+gB!AAhg!A8gQY!BDs!AMAaJ!ALhXBZy/fwEAAGDWfYy9zg!IDUttn73AI&&!AADgQbOUWssS!AkFq5tKtLCQ!EjfvwoYAACA/P2bvYABAABgWdtpXQI!By6qOdRg8!AQw!ACCAAQAAwB9g!AMAUa!A7AEGAACA/7KA9S8!D5LaXWsgQ@@&&&A87LbZ+9wC!AUpt1H2OvMw!CCxuR7t6lhn!AQO7+TV7!AAsNWj3TrqFg!JDT3NtpnwE!A59dFOowc!AIY!APAEGg!AzBAg!GuQ!A4F4VcP7+BQAAgFn3MfY6Aw!FLbZu9zCw@@@@@@@@@@@@&&&!!!!AAHjobbP3uQU!CkNus+xl5n!AQGJzPdrVsc4!CA3P2bvIABAABgq0e7ddQt!AIKe5t9M+Aw!HLqo51GDw!BD!AA4Ak0!AGIIF!A1iABAADAvSrg/P0L!As+5j7HUG!ApLbN3ucW@@@@&&&!!AAH/X0ntfAg!HJ75NHHHnv8iRI!CQWX3yqaeffuqZZ0s!BAXs898/zVCy++pIABAABI7LmXb/7w/LWAlw!ICcXnnp5tbzLz7zS!AEBKr752c3r+qdcD!AMlreePHmzstvBg!GRU3nrh5s7b7wQ!BkVN/9awC/934!BA+gB+/oMt!AIKPy4Ys3p5c+Cg!Ehp+fjp529uvfDJpwE!A5lc8+vy3gL778Kg!CBzAV8T+PnPv9a/!AZFa++fa7t75/4wf9CwAAQG7Ljz/9/MuvnwY@&&!!!P/G0ntfAg!HIr6xhjLQE!CZlUv73aUE!A5O7f7AUM!Ay6X96bIE!AJFXanRI!CQVG13ag!MA9I4ABAADAE2g!AwBAs!CsQQIAAEAB5+9f!AKOsYYy0B!AuS299yU@@@&&&!AO6fpdRalg!IDUyqVdXUo!BA+v5Vw!AOTv3+wFD!AMvaTusS!AkFMf7TR6!AwH9JAAMAAIAABg!H+AAQAAwBRo!AsAcY!ABax/AQAAyG8ptZYl@@@@@@&&+F9ts/e5BQ!KQ26z7GXmc!BAYnM92tWxzg!IDc/Zu8gAEAAGCrR7t11C0!Agp7m30z4D!AcuqjnUYP!AuFcEM!AHgCDQ!IZgAQAAgDVI!AKOD8/Qs!Cz7mPsdQY!Ckts3e5xY@@@@@@@&&&&!AwMPot/bu7EpyEIiiYEIWAqHy397ZVfM9a3d2hBPvXC0@@&&&&!AADAz1rP7C0!CgtP4Ynz16!AQPn+Vc!ADU79/qBQw!DtGLejBQ!NQ017itGQ!PAnCW!AAQw!AOAfY!AHAKN!ALgHG!AAWsfwEAAKiv9czeAg@@@@@&!!!ACA92dm5gw!CobY0vVg!ED5/q1fw!AOjf8gUM!Ac7zM!AgKJyvGQ!DAHyOAAQAAQAADAACAf4ABAADAKd!ADgHm!ABYH6J/AQAAYGbmD@@@@@@&!!AAD4K1rP7C0!CgtP4Ynz16!AQPn+Vc!ADU79/qBQw!DtGLejBQ!NQ017itGQ!PAnCW!AAQw!AOAfY!AHAKN!ALgHG!AAWsfwEAAKiv9czeAg@@@@@@@@@@@@@&&&!!!AAICftDlnCw!KitH2utowc!BU1h/ji0cP!AqN2/1QsY!A2mP88GgB!ARfXx0gM!CKyvGSAQ!P+MAAY!CfQAMAAIBDs!AMA1S!ACjg+v0L!A/VhrHT0!CgtjbnbAE@&&!!C8F+eec58B!Ape281rpyBw!BS2j+f47Hns!AgNr9W7yAAQAA4Mzn+O6ZZw!EBN+xq3awc!DUNNe4rRk!Dwrwhg!A8Ak0!AOAQL!AXIMEAACAAq7fvw!LDzWuvKHQ!FDauefcZw@@&&&!!!AAf9G559xn!AQGk7r7Wu3AE!CF7eM5PnseOw!KB2/xYvY!ADjzOb575hk!BQ077G7doB!ANc01bmsG!A/CsCG!AHwCDQ!A7BAg!NcgAQAAoIDr9y8!DsvNa6cgc!CUdu459xk@@@@@@@&!!!AAC/ambmDACg9o4DAGt8sQIAqL/jAGA3LScAlN9xALCb5ZcTAOw4ADDHywwAoOiOAwA5XjIAgD/GjgOA4QQA7DgAGE4AwI4DgH+H!7DgBOjwQAOw4AuD8QAOw4ALA+xG4CgB0HAGZmzgAA3gM7Dg@@@@@@@@@@&&&&!!!!APAJZd9g1ET9qG0!AASUVORK5CYII=","iVBORw0KGgo!ANSUhEUgAADw!AhwCAM!CnYDt!ABC1BMVEU!Dh4%%%%%%%%%%%%+Ph4+Ph4+Ph4+Ojjy4+!AWHRSTlMADitIVh2BnrrJ5o/XUnOGNs7q9Pb18t2/AQ1g+v790gMZZN77BDe+Qdbc7s/3/Oed8ej47WXrGJMityCtFX8KUSoUdB6Y5Zfwq3DF7/PDXThmiySMmuH5BQH3LQAAKmtJREFUeNrs3QV29DqXhtFjWZIt2ZcZ8t2fmeE2MzPD/EfSVCtrVdxEaTjZew6Bp0qvF@@@@@@@@!AC/ZUtZa17IE!A5NVq3/Yx9q3XFg!JBU6WPejF4C!AUirHOR+dRwk!DI2r/JCxg!BaP+eds7c!CAbOqYT4wa!AkMzS50VfAg!HIp27zYSg!EAu6z4v9jU!Ag9wT4+Uf!AAIIABAADAEWg!BwCRY!B4Bgk!DqeAETY!AGj9nHfO3gI!DSKcd5179HCQ!EhawPn7Fw!Eof82b0Eg!JBUq33bx9i3Xls!BAXktZa13LEg&&&&!!!AwIu1lLXWtSwB!AebXat32Mfeu1BQ!CRV+pg3o5c!CAlMpxzkfnUQI!Cy9m/yAgYAAIDWz3nn7C0!AgmzrmE6MG!AJLP0edGX!AgFzKNi+2Eg!JDLus+LfQ0!DIPgE2AgYAAOC5CW!ABwBBo!BcggU!CeQQIAAIA6XsAEG!AFo/552ztw!IB0ynHe9e9RAg!JIWcP7+BQAAgNLHvBm9B!ACTVat/2Mfat1xY!CQ11LWWteyB@&&&M9qKWuta1kC!A8mq1b/sY+9ZrCw!Eiq9DFvRi8B!AKZXjnI/OowQ!Bk7d/kBQw!Ctn/PO2Vs!BANnXMJ0YN!ASGbp86IvAQ!LmUbV5sJQ!CCXdZ8X+xo!CQewL8/CNg!AEM!ADgCDQ!C4BAs!A8gwQ!B1vIAJM!ALR+zjtnbwE!DplOO869+jB!ACQt4Pz9Cw!KWPeTN6CQ!Eiq1b7tY+xbry0!Agr6Wsta5lCQ@@@&!!AADg/6ClrLWuZQk!DIq9W+7WPsW68t!AIKnSx7wZvQQ!CkVI5zPjqPEg!JC1f5MXM!ALR+zjtnbwE!DZ1DGfGDU!AgmaXPi74E!A5FK2ebGV!AgFzWfV7saw!EDuCfDzj4ABAAB!MAAIAj0!AOASL!APAMEg!NTxAib!AA0Po575y9BQ!KRTjvOuf48S!AkLSA8/cv!AlD7mzegl!AIKlW+7aPsW+9tg!IC8lrLWupYl@@&&&&AA4J+3lNdef+ON118rSw!EBWbx5vvf3Ou++9//YHHx61BQ!OTz0cefnJ8+/O0/enj16fuf9RI!CQzBe++KUvv/rbRw+vvvLOl48S!AkMpXv/b1r/ztTdYCBgAAgK9+45v/2L/3Bfz+t3oL!ASNW/D397KeBPvz1q!AQBZf+Np3vvvwtxcP33v/+30J!ASOKLP/jhq38ugF+99/ZWAg!HL46Gs/euefD+Af/2RfAw!HL4+Keff/cWwHlHw!APAzP/vtTwUw!A6f3cz98COPsRa!AARw+kuw!A4Bd+8V/aAHsGCQAAgER+6Zd/9M73/rkANgEG!gk1/51fnD712/An743vvf6i0!Agi1/77PPvXgv4e+98+SgB!Aafz6b3zr25/eCjhv/wIAAMBv/talgL/y/me9B!AKQu4K/89odHbQE!DJ/Obv/MMO+HuvXj38vd/9vddfK0s!BAPr/++/sffPP7f/hHf/jbf/wnAQ!Hn9yp/+2Z//eX/tLwI@@@@@@@@@@@&&!!AICXZilrrWtZAg!PJqtW/7GPvWaws!BIqvQxb0YvAQ!CmV45yPzqME!AZO3f5AUM!ArZ/zztlb!AQDZ1zCdGDQ!Ehm6fOiLwE!C5lG1ebCU!Agl3WfF/sa!AkHsC/PwjY!ABD!AA4Ag0!AuAQL!APIME!AdbyACT!AC0fs47Z28B!A6ZTjvOvfowQ!AkLeD8/Qs!Clj3kzegk!BIqtW+7WPsW68t!AIK+lrLWuZQk@@@@@@&!!!ACAl2Apa61rWQI!DyarVv+xj71msL!ASKr0MW9GLwE!ApleOcj86jB!AGTt3+QFD!AK2f887ZWw!EA2dcwnRg0!BIZunzoi8B!AuZRtXmwl!AIJd1nxf7Gg!JB7Avz8I2!AAQw!AOAIN!ALgECw!DyDB!AHW8gAkw!AtH7OO2dvAQ!OmU47zr36ME!AJC3g/P0L!ApY95M3oJ!ASKrVvu1j7FuvLQ!CCvpay1rmUJ@@@@@@@@@&&!!!AgsaWsta5lCQ!Mir1b7tY+xbry0!AgqdLHvBm9B!AKRUjnM+Oo8S!AkLV/kxcw!AtH7OO2dvAQ!NnUMZ8YNQ!CCZpc+LvgQ!DkUrZ5sZU!CAXNZ9Xuxr!AQO4J8POPgAEAAE!wAAgCPQ!A4BIs!A8AwS!A1PECJs!ADQ+jnvnL0F!ApFOO865/jxI!CQtIDz9y8!CUPubN6CU!AgqVb7to+xb722!AgLyWsta6liU@@!!!!HhiKWuta1kC!A8mq1b/sY+9ZrCw!Eiq9DFvRi8B!AKZXjnI/OowQ!Bk7d/kBQw!Ctn/PO2Vs!BANnXMJ0YN!ASGbp86IvAQ!LmUbV5sJQ!CCXdZ8X+xo!CQewL8/CNg!AEM!ADgCDQ!C4BAs!A8gwQ!B1vIAJM!ALR+zjtnbwE!DplOO869+jB!ACQt4Pz9Cw!KWPeTN6CQ!Eiq1b7tY+xbry0!Agr6Wsta5lCQ@&&&&!!!!ACA/3lLWWtdyxI!CQV6t928fYt15b!AQFKlj3kzegk!BIqRznfHQeJQ!CBr/yYvY!AGj9nHfO3gI!CyqWM+MWo!BAMkufF30J!AyKVs82IrAQ!Lms+7zY1w!IDcE+DnHwEDAAC!Y!BHoAEAAMAlW!AOAZJ!AKjjBUyAAQAAoPVz3jl7Cw!EinHOdd/x4l!AIGkB5+9f!AKH3Mm9FL!AQFKt9m0fY996bQE!B5LWWtdS1L@@@@@@@@@!!!XC1lrXUtSw!EBerfZtH2Pfem0B!ASZU+5s3oJQ!CClcpzz0XmU!AgKz9m7yAAQAAoPVz3jl7Cw!MimjvnEqAE!DJLH1e9CU!Agl7LNi60E!A5LLu82JfAw!HJPgJ9/BAw!ACG!AByBBg!JdgAQAAgGeQ!AoI4XMAEGAACA1s955+wt!AIJ1ynHf9e5QAAODfYSlrrWtZAoD/PwX8H+1fAABa7ds+xr712gKA/x9KH/Nm9BIAAPy/+hcKAB9fAgA4RAeAAQsAgGtU!AwEMa!AUMd8YtQ!CAZJY+L/oS!AkEvZ5sVWAgAAyHUtIbDu82JfAwAAyPcwHZgA/+dHw!QOlj3oxeAsgcw!4F3R/K+KgiPQAACgf5MXMLgECwAAaP2cd87eAsj8DBIAANgUXheFgB9YAADwhRLgyAYAAJgUAkb7AADgUlnAte0AAOBZUcDD3QAAIICBVvu2j7FvvbY!DyHoEGlrLWupYl!Al2ABAACAZ5!AAwAs45AQYAAIDWz3nn7C0!Ag7aui+d8VBQAAQAHn718!Aofcyb0Us!BAUq32bR9j33ptAQ!HktZa11LUs@@@@!!!!AADy3pay1rmUJ!AyKvVvu1j7FuvLQ!CCp0se8Gb0E!ApFSOcz46jxI!CQtX+TFz!AC0fs47Z28B!A2dQxnxg1!AIJmlz4u+B!AORStnmxlQ!IBc1n1e7Gs!BA7gnw84+AAQAAQAADAACAI9!ADgEiw!DwDBI!DU8QImw!AND6Oe+cvQU!CkU47zrn+PEg!JC0gPP3Lw!JQ+5s3oJQ!CCpVvu2j7FvvbY!CAvJay1rqWJQ@@@@@&&&&ABy+jv27iBHYhMIwyguQ9lg7n/ebFoj9fQui45S894tPomfAg@@@@@@@@&&AACAbzni7P2MowEAAEBdo+d1z3lf2UcDAACAoiLnepkZDQ!EqKZ68f+4kG!AVfu3eAEDAADAyL3e7BwN!Aqulz/TJ7AwAAgGKOXB/ya!AFBLXOvDFQ0!BqOe/14T4b!A1JsAf3cED!AAIY!APIEG!An2ABAACAM0g!DQ5x+YAAMAAMDIvd7sHA0!DKiWe/9e8TDQ!IoWcP3+BQAAgMi5XmZGAwAAgKJGz+ue876yjwY!B1HXH2fsbR&&&!!!AA+N854uz9jKMBAABAXaPndc95X9lHAwAAgKIi53qZGQ0!BKimevH/uJBg!FX7t3gBAwAAwMi93uwcDQ!Krpc/0yewMAAIBijlwf8mg!BQS1zrwxUN!Aajnv9eE+Gw!NSbAH93BAw!ACG!ADyBBg!J9gAQAAgDNI!A0OcfmAADAADAyL3e7BwN!Ayolnv/XvEw0!CKFnD9/gUAAIDIuV5mRgMAAICiRs/rnvO+so8G!AdR1x9n7G0Q@@@@@@@@&&!!!AD4bx1x9n7G0Q!KCu0fO657yv7KMBAABAUZFzvcyMBg!CXFs9eP/UQDAACAqv1bvIABAABg5F5vdo4G!A1fS5fpm9AQAAQDFHrg95N!AKglrvXhigY!C1nPf6cJ8N!A6k2AvzsCBg!AEM!AnkADAACAT7!ADAGSQ!Do8w9MgAEAAGDkXm92jgY!DlxLPf+veJBg!EULuH7/AgAAQORcLzOjAQAAQFGj53XPeV/ZRwMAAIC6jjh7P+No@@@@@@@@@&&!!A/DtHnL2fcTQ!Coa/S87jnvK/to!AUFTkXC8zowEAAEBJ8ez1Yz/R!AoGr/Fi9g!AGLnXm52jAQAAQDV9rl9mbw!FDMketDHg0!BqiWt9uKIBAABALee9PtxnAwAAgHoT4O+OgAEAAE!wAAgCfQ!A4BMs!AcAYJ!A+vwDE2!AAYudebnaMBAABAOfHst/59ogEAAEDRAq7fvw!BA518vMa!AFDU6Hndc95X9tE!CgriPO3s84Gg&&AJTgYAc!CMntc9531lHw0!CKipzrZWY0!AKCmevX7sJxo!BU7d/iBQw!Aj93qzczQ!Cops/1y+wN!AijlyfcijAQAAQC1xrQ9XN!AKjlvNeH+2w!BQbwL83REw!ACG!ADwBBo!B8ggU!DOIAEAAECff2ACD!ACP3erNzN!ACgnnv3Wv080!AKFrA9fsX!AIud6mRkN!Aiho9r3vO+8o+Gg!NR1xNn7Ge4fAQ!!!AAP+0d0epCcRgGEUzcSZVBgUqDQKTCuiTBYuMS1F1/ytpkQKVvheanrOLC/+X@@@@@&&&&!!!AMBf08T54nQ+nxbz2AQ!CoU9f2q8thvF7Hw2XVt10!CACsW0zkMpt0+lDHmdYg!IDqxH6z3Jfbl7JfbvoY!AoOr+Vc!ADUqUu7vC23b8o271IX!AoCbt7G14fQzg1+Ft1gY!CoSJPe871/Hwo4v6cm!AQD3i0/PLzwB+eX6KAQ!OoxmR7HnwE8HqeT!AAPVNgH97BAw!ACG!AJxAAwAAgEew!AwDdI!AGAFXPgEGAACALu3y9jGAt3mXug!ABVif1muS/f+ne/3PQx!AQJUFXHv/AgAAQEzrPJRyz98y5HWKAQ!CrUtf3qchiv1/FwWfVtFw!KBOTZwvTufzaTGPTQ@@@@@@@@@@@@@@&&!!!!AA+Kc+AEtl2Lc5UjmS!AAElFTkSuQmCC"];function star_url(e){let t=star_images[e];return t=t.replaceAll("%",["","","","&","EhIS","+Ph4"][e].repeat(7)),t=t.replaceAll("@","&&&&&"),t=t.replaceAll("&","!!!!!"),t=t.replaceAll("!","AAA"),"data:image/png;base64,"+t}var sp=0;function stars_update(){let e=gel("stars");for(let t=0;t<6;++t){let A="stars"+t,r=gel(A);r||(r=addImage(e,star_url(t%3+3),0,0),r.id=A,r.style.width="100%",r.style.height="100%",imageSetZ(r,t+1)),moveImage(e,r,(sp*((t%3+1)/3)%100-(t<3?0:100))*e.clientWidth/100,0)}sp+=45/render_fps,sp%=1200}function stars_resize(){for(let e=0;e<stars.length;++e)stars[e].kill();stars=[]}const cool_values=[0,1,2,3,4,5,10,-1,-2,-3,-4,-5,-10];var cur_challenges={},gamespeed=4,target_challenge=10,cur_challenge_total=0,skill_multiplier=1,completed=0,game_timer=0,misses=0;const ramp_up_time=300,ramp_speed=1.01,challenges=[0,"b0Akmi","a0Bkmi","a0Almi","A1Akni","b1Alni","b0Akmj","a1Cknj","a0Bkmj","B1Akni","c1Akni","a1Ckni","c1Akoi","b1Bkni","c0Akmi","b1Alni","b2Akni","a1Alnj","b0Almj","d0Akmi","c2Akni","a3Akoi"];function find_challenge_code(){let e=Math.floor(completed/5)+1,t=challenges[e];if(t)try{let e=t[0],A=t[1],r=t[2],n=t[3],l=t[4],o=t[5];if(simplification_tasks[e][A][r][n][l][o].length)return t}catch(o){console.log("No challenges for code "+t)}let A=Math.max(12,target_challenge-cur_challenge_total),r=0,n=simp_ratings.length-r;for(;n>0;){let e=n>>1,t=r+e;simp_ratings[t][0]<A?(r=t+1,n-=e-1):n=e}let l=random2(0,r);return simp_ratings[l][1]}function find_challenge(e){try{let t=e[0],A=e[1],r=e[2],n=e[3],l=e[4],o=e[5],a=simplification_tasks[t][A][r][n][l][o],s=a[random2(0,a.length-1)],i=t>="A"&&t<="Z";if("1"==A&&"n"==l){let e=function(t){if(is_array(t))for(let A=0;A<t.length;++A){let r=e(t[A]);if(r)return r}else if(0!=t.fac)for(let e=t.vars,A=0;A<e.length;++A)return e[A]},A=e(poly_simplify(s));if(A){let e=cool_values[random2(0,cool_values.length-1)],r={};r[A]=e;let n=poly_simplify(s,r),l=make_fraction(n[0].fac);if(1==n.length&&"vars"in n[0]&&0==n[0].vars.length&&("a"==t||Math.abs(n[0].fac)<=20)&&(1==l[1]||Math.abs(l[0])<l[1])){return[s,TOK_EQ,n,[A,TOK_EQ,[{fac:e,vars:[]}]]]}}}return i?null:[[],null,s,null]}catch(t){return console.log("Could not find tasks for "+e),null}}function update_challenge(e,t,A){let r=e.style,n=(t+e.offsetWidth/2)/A.offsetWidth;r.color=n<.63?"#5F5":n<.81?"#FF5":"#F55",r.left=t+"px"}function challenge(e,t,A){let r=gel("gamewin");e.style.position="absolute",e.style.color="#000",e.style.left="50%",e.style.top="50%",imageSetZ(e,8),dom_append(r,e),this.x0=-e.offsetWidth,this.x=0,this.y=random2(0,r.offsetHeight-3*e.offsetHeight),this.htmltag=e,this.dead=!0,this.points=0;let n=()=>this.x*r.clientWidth/100+this.x0;for(let a in cur_challenges){let t=cur_challenges[a].htmltag,A=n();if(!(t.offsetTop>this.y+2*e.offsetHeight+20||t.offsetLeft>A+2*e.offsetWidth+20||t.offsetTop+2*t.offsetHeight+20<this.y||t.offsetLeft+2*t.offsetWidth+20<A))return void r.removeChild(e)}let l=()=>update_challenge(e,n(),r);e.style.position="absolute",e.style.top=this.y+"px",l(),this.dead=!1,this.kill=function(){r.removeChild(e),this.dead=!0},this.tick=function(){this.dead||(l(),this.x+=gamespeed/render_fps,n()>=r.clientWidth&&(this.kill(),++misses>=10&&game_over()))};let o={};if(t[1]){let e=poly_rank(t[2]),r=poly_rank(t[0]);console.log(poly_rendertext(t[2])," in ",A," is worth ",e," pts"),console.log(poly_rendertext(t[0])," in ",A," is worth ",r," pts"),this.points=e+r;let n=t[3],l=poly_rendertext(n[2]),a="string"==typeof n[0]?n[0]:poly_rendertext(n[0]);o[a+text_sign(n[1])+l]=!0}else{let e=poly_rendertext(poly_simplify(t[2]));o[e]=!0,this.points=poly_rank(t[2]),console.log(poly_rendertext(t[2])," in ",A," is worth ",this.points," pts")}this.test_solution=e=>e in o}function spawn(){var e=find_challenge_code();let t=find_challenge(e);if(!t)return;let A=null;A=t[1]?poly_render_latex(t[0])+latex_sign(t[1])+poly_render_latex(t[2]):poly_render_latex(t[2]),latex_render(A,(A=>{let r=0;for(;r in cur_challenges;)++r;cur_challenges[r]=new challenge(A,t,e),cur_challenge_total+=cur_challenges[r].points}))}function game_submit(e){let t=null;t=e[1]?poly_rendertext(e[0])+text_sign(e[1])+poly_rendertext(e[2]):poly_rendertext(e[2]);for(let A in cur_challenges){let e=cur_challenges[A];!e.dead&&e.test_solution(t)&&(create_score_object(e.points,e.htmltag),decorations_tick(),score+=e.points,++completed,e.kill(),render_score())}}var scorelog=[],last_scorelog=0;function game_check_performance(){let e=game_timer-last_scorelog,t=!1;for(;e>1;)scorelog.push(score),e=game_timer-(last_scorelog+=1),t=!0;for(;scorelog.length>60;)scorelog.shift();if(t){let e=0,t=0;for(let A=1,r=1;r<scorelog.length;++r)t+=(scorelog[r]-scorelog[r-1])*A,e+=A,A*=1.03;if(e){(target_challenge=(target_challenge/skill_multiplier*.95+.05*(25*(t/e)))*skill_multiplier)<10&&(target_challenge=10),game_timer>=ramp_up_time&&(skill_multiplier*=ramp_speed),render_score()}}}var input_idle=0,input_idle_timeout=5;function game_tick(){let e=cur_challenges;cur_challenge_total<target_challenge&&spawn();for(let A in e)if(e[A].dead){cur_challenge_total-=e[A].points,delete e[A];break}for(let A in e)e[A].dead||e[A].tick();game_check_performance(),game_timer+=1/render_fps,""==curinput?++input_idle:(input_idle=0,input_idle_timeout=60);const t=30;if(input_idle<render_fps*input_idle_timeout){gamespeed<4?gamespeed*=(4/.5)**(1/(4*render_fps)):gamespeed=4,render_fps<t?render_fps*=Math.pow(7.5,1/(2*render_fps)):render_fps=t}else{gel("gamewin");let A=0;for(let t in e)e[t].dead||(A=Math.max(A,e[t].x));const r=.2;if(A>10){gamespeed>r&&(gamespeed*=(r/4)**(1/(5*render_fps)));let e=60;focused||(e=1),render_fps*=Math.pow(2/t,1/(e*render_fps))}}render_fps>t?render_fps=t:render_fps<2&&(render_fps=2)}function create_score_object(e,t){let A=gel("gamewin"),r=gel("score"),n=gel("statswin"),l=t.offsetLeft,o=t.offsetTop,a=r.offsetLeft+n.offsetLeft,s=r.offsetTop+n.offsetTop,i=dom_tag_attr_text("deco",{className:"deco"},"+"+Math.round(e,1));dom_append(A,i),i.spawned_at=game_timer,i.srcpos=[l,o],i.tgtpos=[a,s];let f=i.style,c=i.srcpos[0],g=i.srcpos[1];f.left=c+"px",f.top=g+"px"}function decorations_tick(){let e=gel("gamewin"),t=dom_rtags(document,"deco");for(let A=0;A<t.length;++A){let r=t[A],n=game_timer-r.spawned_at;if(n*=3,n>=1)e.removeChild(r);else{let e=r.style,t=r.srcpos[0]+(r.tgtpos[0]-r.srcpos[0])*n,A=r.srcpos[1]+(r.tgtpos[1]-r.srcpos[1])*n;e.left=t+"px",e.top=A+"px"}}}
